üè® Hotel Booking System

### –û–ø–∏—Å–∞–Ω–∏–µ
–£—á–µ–±–Ω–∞—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–µ–ª–µ–π –Ω–∞ Spring Boot 3/Spring Cloud: JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, Gateway, Eureka, —É—Å—Ç–æ–π—á–∏–≤—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é –∏ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–µ–π.

![img.png](img.png)

### –°–µ—Ä–≤–∏—Å—ã –∏ –ø–æ—Ä—Ç—ã
- `eureka-server` ‚Äî discovery, `8761`
- `api-gateway` ‚Äî JWT resource server + –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, `8080`
- `hotel-service` ‚Äî –æ—Ç–µ–ª–∏, –Ω–æ–º–µ—Ä–∞, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, `8081`
- `booking-service` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, —Å–∞–≥–∏, `8082`

### –ó–∞–ø—É—Å–∫
```bash
mvn clean install              # —Å–±–æ—Ä–∫–∞ (–Ω—É–∂–Ω–∞ –∑–∞–ø–∏—Å—å –≤ ~/.m2)

cd eureka-server   && mvn spring-boot:run &
cd hotel-service   && mvn spring-boot:run &
cd booking-service && mvn spring-boot:run &
cd api-gateway     && mvn spring-boot:run &
```
–ü—Ä–æ–≤–µ—Ä–∫–∞ discovery: http://localhost:8761

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- JWT –≤—ã–¥–∞—ë—Ç—Å—è –≤ booking-service (`/user/auth`), –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Å–µ–∫—Ä–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.
- Gateway –∏ backend-—Å–µ—Ä–≤–∏—Å—ã –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç —Ç–æ–∫–µ–Ω (Resource Server).
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –≤—ã–∑–æ–≤—ã –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Internal-Secret: gateway-approved` (gateway –¥–æ–±–∞–≤–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).
- –†–æ–ª–∏: `USER` (–ø—Ä–æ—Å–º–æ—Ç—Ä, –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ), `ADMIN` (CRUD –æ—Ç–µ–ª–µ–π/–Ω–æ–º–µ—Ä–æ–≤/–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π).

### –≠–Ω–¥–ø–æ–π–Ω—Ç—ã
**Gateway –º–∞—Ä—à—Ä—É—Ç—ã** (—á–µ—Ä–µ–∑ `http://localhost:8080`):
- Booking: `/user/**`, `/api/bookings/**`
- Hotel: `/api/hotels/**`, `/api/rooms/**`

**Booking-service**
- `POST /user/register` ‚Äî —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤–µ—Ä–Ω—É—Ç—å JWT (—Ä–æ–ª—å USER, –ø–∞—Ä–æ–ª—å —Ö—ç—à–∏—Ä—É–µ—Ç—Å—è)
- `POST /user/auth` ‚Äî –≤—ã–¥–∞—Ç—å JWT
- `GET /api/bookings?page=&size=` ‚Äî —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (USER) –∏–ª–∏ –≤—Å–µ (ADMIN)
- `POST /api/bookings` ‚Äî —Å–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç–µ–ª–æ: `hotelId`, `startDate`, `endDate`; –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `idempotencyKey`), –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Idempotency-Key` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
- `PUT /api/bookings/{id}/confirm` ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–≤–æ—é –±—Ä–æ–Ω—å (ADMIN –º–æ–∂–µ—Ç –ª—é–±—ã–µ)
- `PUT /api/bookings/{id}/cancel` ‚Äî –æ—Ç–º–µ–Ω–∏—Ç—å

–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: PENDING ‚Üí –∑–∞–ø—Ä–æ—Å –≤—ã–¥–µ–ª–µ–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã –≤ hotel-service (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ) ‚Üí CONFIRMED; –ø—Ä–∏ —Å–±–æ—è—Ö ‚Äî CANCELLED —Å –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–µ–π release.

**Hotel-service**
- `GET /api/hotels` ‚Äî —Å–ø–∏—Å–æ–∫; `POST/PUT/DELETE /api/hotels/**` ‚Äî ADMIN
- `GET /api/hotels/{id}/stats` ‚Äî occupancy –ø–æ –æ—Ç–µ–ª—é
- `GET /api/rooms` ‚Äî –≤—Å–µ –∫–æ–º–Ω–∞—Ç—ã
- `GET /api/rooms/search?available=&minTimesBooked=&sortBy=&direction=` ‚Äî —Ñ–∏–ª—å—Ç—Ä—ã/—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- `GET /api/rooms/recommend` ‚Äî –Ω–∞–∏–º–µ–Ω–µ–µ –∑–∞–Ω—è—Ç—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ
- `GET /api/rooms/stats` ‚Äî —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏
- `GET /api/rooms/analytics/occupancy` ‚Äî –≥–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `POST /api/rooms` ‚Äî —Å–æ–∑–¥–∞—Ç—å (ADMIN)
- `POST /api/rooms/{id}/confirm-availability` ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≤—ã–∑–æ–≤ —Å `Idempotency-Key` (–ø–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)
- `POST /api/rooms/{id}/release` ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π release
- `POST /api/rooms/allocate?hotelId=` ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∞—Ç–æ–º–∞—Ä–Ω—ã–π –≤—ã–±–æ—Ä –Ω–∞–∏–º–µ–Ω–µ–µ –∑–∞–Ω—è—Ç–æ–π –∫–æ–º–Ω–∞—Ç—ã
- `PUT/DELETE /api/rooms/{id}` ‚Äî ADMIN

### –í–∞–∂–Ω—ã–µ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏
- `Idempotency-Key` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è–µ–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è; –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∑–∞–ø–∏—Å—å.
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±—Ä–æ–Ω–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è `hotelId`, `startDate`, `endDate` (>= today, end >= start).
- Booking –∏ hotel –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ + `@Version` –¥–ª—è –±–æ—Ä—å–±—ã —Å –≥–æ–Ω–∫–∞–º–∏.
- Gateway –¥–æ–±–∞–≤–ª—è–µ—Ç `X-Trace-Id` –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏; —Å–µ—Ä–≤–∏—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç JSON —Å–æ `traceId`.

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –Æ–Ω–∏—Ç/–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: JUnit5 + MockMvc/WebTestClient.
- –ó–∞–ø—É—Å–∫: `mvn test` (–ø–æ –º–æ–¥—É–ª—è–º: `mvn -pl booking-service test`, `mvn -pl hotel-service test`).

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
- Booking: http://localhost:8082/swagger-ui/index.html
- Hotel: http://localhost:8081/swagger-ui/index.html

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- JDK 17, Maven 3.9+, H2 in-memory (–¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏).
- Lombok –∏ MapStruct —Ç—Ä–µ–±—É—é—Ç—Å—è –¥–ª—è —Å–±–æ—Ä–∫–∏ (IDE: –≤–∫–ª—é—á–∏—Ç—å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏).

